---
title: "CLIï¼šéšä¾¿è°ˆè°ˆ Rust ä»¥åŠç”¨ Rust ç¼–å†™å‘½ä»¤è¡Œåº”ç”¨"
date: 2020-01-23T00:20:00+08:00
draft: true
show_in_homepage: true
show_description: true
tags:
- Tech
- Rust
- CLI
featured_image: 'https://i.loli.net/2020/01/22/OzrcsukSVqtNAle.png'
comment: true
toc: true
autoCollapseToc: true
---

å‰å‡ å¤© Stack Overflow åšå®¢ä¸Šé¢æœ‰ä¸€ç¯‡æ–‡ç« [^1]ï¼Œé‡Œé¢æåˆ°äº† Rust å·²ç»è¿ç»­å››å¹´ä½åˆ— Stack Overflow ç¤¾åŒºæœ€çˆ±ç¼–ç¨‹è¯­è¨€æ¦œé¦–ã€‚çš„ç¡®ï¼ŒRust æ˜¯ä¸€é—¨ç¥å¥‡åˆç¾ä¸½çš„è¯­è¨€ã€‚Rust æ˜¯ä¸€é—¨æ ‡æ¦œ safe ä¸ zero-cost abstraction çš„è¯­è¨€[^2]ï¼Œæ„å‘³ç€åªè¦ä½ ç¼–å†™çš„ Rust ä»£ç ç¬¦åˆå®˜æ–¹æ ‡å‡† â€”â€” èƒ½å¤Ÿé€šè¿‡ç¼–è¯‘ â€”â€” é‚£ä¹ˆä½ çš„é¡¹ç›®å‡ ä¹å¯ä»¥è‚¯å®šåœ°è¯´æ˜¯å†…å­˜å®‰å…¨çš„ã€‚

## åˆè¡·

åå‘åº•å±‚çš„ Rust è®©æˆ‘åœ¨ä¹‹å‰ä¸€ç›´æ²¡æœ‰æœºä¼šå°è¯•ï¼Œæ¯•ç«Ÿæˆ‘ç›¸ä¿¡å›½å†…é«˜æ ¡æ²¡æœ‰ä¸€æ‰€æ˜¯æ•¢ç›´æ¥æŠ›å¼ƒ Cã€C++ è€Œä½¿ç”¨ Rust ä½œä¸ºå…¶ä¸»è¯­è¨€è¿›è¡Œæˆè¯¾çš„ã€‚æœ€è¿‘æˆ‘é‡æ„äº† [Dev on Windows with WSL](https://dowww.spencerwoo.com)ï¼šä¸€ä¸ªè¿‘ 2w å­—çš„ WSL å¼€å‘é…ç½®æ–‡æ¡£ã€‚æˆ‘å‰åç”¨äº†å¤§æ¦‚åŠä¸ªæœˆçš„æ—¶é—´ï¼Œå¢åŠ äº†è®¸å¤šå†…å®¹ï¼Œå› æ­¤æˆ‘åœ¨ç»“æŸç¼–å†™å·¥ä½œä¹‹åï¼Œè¯•å›¾æ‰¾åˆ°ä¸€ä¸ªç±»ä¼¼ `cloc`ï¼Œèƒ½å¸®æˆ‘ç»Ÿè®¡ä¸€ä¸ªç›®å½•ä¸‹å…¨éƒ¨ Markdown æ–‡ä»¶çš„å‘½ä»¤è¡Œå·¥å…·ã€‚å¾ˆå¤±æœ›ï¼Œæ²¡æ‰¾åˆ°ã€‚

æˆ‘å†³å®šè‡ªå·±å°è¯•å®ç°è¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå½“ç„¶ï¼Œæˆ‘ä¹Ÿç›¸ä¿¡ Pythonã€Node.jsã€Ruby ç­‰è„šæœ¬è¯­è¨€ä¸€å®šé€‚åˆåšè¿™äº›äº‹æƒ…ï¼Œæ¯•ç«Ÿ `cloc` æœ¬èº«å°±æ˜¯ä½¿ç”¨ Perl å®ç°çš„ã€‚ä¸è¿‡ï¼ŒRust ä½œä¸ºä¸€é—¨é«˜æ•ˆçš„ã€é™æ€çš„ã€å¯ä»¥ç›´æ¥ç¼–è¯‘åˆ°ä¸‰ä¸ªæ“ä½œç³»ç»Ÿçš„åº•å±‚è¯­è¨€ï¼Œè¿˜æ˜¯å¾ˆæœ‰å¸å¼•åŠ›çš„ã€‚å› æ­¤æˆ‘æ‰å†³å®šä½¿ç”¨ Rust å¼€æ–°å‘ã€‚

![ä½¿ç”¨ Rust å®ç°çš„ cwim - Count words in Markdown](https://i.loli.net/2020/01/23/g1q5amsOedyE7op.png)

## å¦‚ä½•å¼€å§‹ä¸€ä¸ª Rust é¡¹ç›®ï¼Ÿ

Rust æœ€ beginner friendly çš„åœ°æ–¹æˆ‘è§‰å¾—åœ¨äºå…¶[å®˜æ–¹å…¥é—¨æ–‡æ¡£](https://www.rust-lang.org/zh-CN/learn/get-started)çš„ç®€æ´æ˜“æ‡‚ã€‚ä»å®‰è£…ã€ç¼–è¯‘åˆ°åŒ…ç®¡ç†ã€æ‰“åŒ…é¡¹ç›® â€¦â€¦ Rust çš„å®˜æ–¹æ–‡æ¡£è®²è§£çš„éƒ½æ¯”ä»»ä½•å…¶ä»–è¯­è¨€çš„æ–‡æ¡£è®²è§£çš„è¦æ˜“æ‡‚ä¸å°‘ã€‚æˆ‘è¿™é‡Œç®€å•è®°å½•ä¸€ä¸‹ Rust ç¯å¢ƒçš„å®‰è£…æ­å»ºçš„åŸºæœ¬è¿‡ç¨‹ã€‚

### å®‰è£… Rust ç¯å¢ƒ

Rust è¯­è¨€è™½ç„¶å°ä¼—ï¼Œä½†æ˜¯å…¶ç”Ÿæ€ç›¸å½“å®Œå–„ã€‚Rust å€Ÿé‰´äº†å…¶ä»–è¯­è¨€çš„å¤šç§ç¯å¢ƒé…ç½®å·¥å…·ï¼Œå®˜æ–¹ç›´æ¥æä¾›äº†ä¸€æ•´å¥—å®Œå–„çš„é—­ç¯ Toolkitï¼ŒåŸºæœ¬èƒ½æ»¡è¶³æˆ‘ä»¬åœ¨ä½¿ç”¨ Rust æ—¶çš„å®‰è£…ã€æ„å»ºã€ç¼–è¯‘ã€å‘å¸ƒçš„æ•´å¥—æµç¨‹ï¼š

- Rustupï¼šRust ç‰ˆæœ¬ç®¡ç†ï¼ˆç±»ä¼¼ Python çš„ `pyenv`ã€Node.js çš„ `nvm` ç­‰ï¼‰
- Cargoï¼šRust æ„å»ºå·¥å…·ä¸åŒ…ç®¡ç†ï¼ˆç±»ä¼¼ Python çš„ `pip`ã€Node.js çš„ `yarn` ç­‰ï¼‰
- crates.ioï¼šRust çš„ Package Registry

é¦–å…ˆï¼Œæˆ‘ä»¬å®‰è£… Rustupï¼šRust å®‰è£…å™¨ä¸ Rust ç‰ˆæœ¬æ§åˆ¶å™¨ã€‚ä½¿ç”¨ Arch Linuxï¼ˆä»¥åŠ WSL çš„ Arch Linuxï¼‰çš„åŒå­¦å¯ä»¥ç›´æ¥åœ¨ AUR ä¸­å®‰è£… `rustup`ï¼š

```bash
yay rustup
```

å¦‚æœä½¿ç”¨ WSL å…¶ä»– Linux å‘è¡Œç‰ˆï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤å®‰è£… `rustup`ï¼š

```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

å…¶ä»–å®‰è£…æ–¹æ³•è¯·å‚è€ƒï¼š[Rust | å®‰è£… Rust](https://www.rust-lang.org/zh-CN/tools/install)

å®‰è£…äº† `rustup` ä¹‹åï¼Œæˆ‘ä»¬å°±åº”è¯¥å·²ç»å®‰è£…å®Œæˆäº† Cargoï¼šRust çš„æ„å»ºå·¥å…·ä¸åŒ…ç®¡ç†å·¥å…·ã€‚Cargo å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼š

```bash
cargo build     # å¯ä»¥æ„å»ºé¡¹ç›®
cargo run       # å¯ä»¥è¿è¡Œé¡¹ç›®
cargo test      # å¯ä»¥æµ‹è¯•é¡¹ç›®
cargo doc       # å¯ä»¥ä¸ºé¡¹ç›®æ„å»ºæ–‡æ¡£
cargo publish   # å¯ä»¥å°†åº“å‘å¸ƒåˆ° crates.io
```

è¦æ£€æŸ¥æ˜¯å¦å®‰è£…äº† Rust å’Œ Cargoï¼Œå¯ä»¥åœ¨ç»ˆç«¯ä¸­è¿è¡Œï¼š

```bash
cargo --version
```

æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ Cargo æ¥åˆ›å»ºä¸€ä¸ª Rust é¡¹ç›®ï¼Œå¹¶ç”¨å®ƒæ¥å®‰è£…æˆ‘ä»¬å¿…é¡»çš„ Rust åº“ç­‰å†…å®¹ã€‚

### Rust / VS Code

VS Code æ˜¯ä¸€ä¸ªé€šç”¨çš„æ–‡æœ¬ / ä»£ç ç¼–è¾‘å™¨ï¼Œèƒ½å¤Ÿé€šè¿‡æ’ä»¶æ”¯æŒå¤šç§è¯­è¨€ç¯å¢ƒä¸‹ä»£ç çš„ç¼–å†™ä»»åŠ¡ã€‚æˆ‘ä»¬ä¸‹è½½ Rust å®˜æ–¹æä¾›çš„ VS Code æ’ä»¶ï¼š[Visual Studio Code Marketplace | Rust (rls)](https://marketplace.visualstudio.com/items?itemName=rust-lang.rust)

![Visual Studio Code Marketplace | Rust (rls)](https://i.loli.net/2020/01/24/QR4GTfrbq2DCHK8.png)

ä¹‹åï¼Œæˆ‘ä»¬ç”¨ Cargo åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›® `hello-rust`ï¼š

```bash
cargo new hello-rust
```

æˆ–è€…åœ¨å·²æœ‰æ–‡ä»¶å¤¹ `hello-rust` ä¸‹ï¼Œç”Ÿæˆæ–° Rust é¡¹ç›®ï¼š

```bash
cd hello-rust
cargo init
```

æ–°çš„ Rust é¡¹ç›®ç›®å½•ä¸‹åº”è¯¥æ‹¥æœ‰ä»¥ä¸‹å†…å®¹ï¼š

```bash
hello-rust      # æ ¹ç›®å½•
|- Cargo.toml   # Rust çš„æ¸…å•æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«é¡¹ç›®çš„å…ƒæ•°æ®å’Œä¾èµ–åº“
|- src
  |- main.rs    # ä¸»ç¨‹åºå…¥å£
```

ç”¨ VS Code æ‰“å¼€è¿™ä¸€ç›®å½•ï¼Œæˆ‘ä»¬å³å¯å¼€å§‹ Rust é¡¹ç›®çš„ç¼–å†™ã€‚

![ä½¿ç”¨ VS Code æ’°å†™ Rust é¡¹ç›®](https://i.loli.net/2020/01/24/3gZDyvY95UHAtiC.png)

ä½¿ç”¨ä¸‹é¢å‘½ä»¤å³å¯è¿è¡Œé¡¹ç›®ï¼š

```bash
cargo run
```

## Rust è¯­è¨€ç‰¹æ€§

åœ¨ä½¿ç”¨ Rust çš„æ—¶å€™ï¼Œæœ‰ä¸¤ä¸ªä»¤æˆ‘å°è±¡æ·±åˆ»çš„åœ°æ–¹ï¼šä¸€ä¸ªæ˜¯ Rust è¯­è¨€å®é™…ä¸Šéå¸¸æ¸…æ™°æ˜“æ‡‚ï¼Œæœ‰ Cã€C++ ç­‰å¼ºç±»å‹è¯­è¨€çš„ä¸¥è°¨ï¼Œä¹Ÿæœ‰è„šæœ¬è¯­è¨€çš„æ˜“è¯»ï¼›å¦ä¸€ä¸ªå°±æ˜¯ Rust ç¼–è¯‘å™¨éå¸¸ä¸¥æ ¼ï¼Œä½†ç»™æˆ‘ä»¬çš„é—®é¢˜æç¤ºä¹Ÿéå¸¸æ¸…æ™°ï¼Œæ–¹ä¾¿è¿½æº¯é—®é¢˜æ‰€åœ¨ï¼Œå®¹æ˜“ debugã€‚ä¸¥è‹›çš„ Rust ç¼–è¯‘å™¨è®©æˆ‘ä»¬å¿…é¡»è€ƒè™‘ã€Œå†…å­˜åˆ†é…ã€ï¼Œä¹Ÿæ­£å› å¦‚æ­¤ï¼Œä½¿å¾— **Rust åœ¨å¹¶æœªå®ç°ã€Œåƒåœ¾å›æ”¶ã€çš„å‰æä¸‹ï¼Œç¡®ä¿äº†ä»»ä½• Rust ç¨‹åºéƒ½ç”Ÿæ¥å…·æœ‰ã€Œå†…å­˜å®‰å…¨ã€ç‰¹æ€§ã€‚**

> ğŸ§² **Rust Playground**
>
> ä¸‹é¢æ¶‰åŠåˆ°çš„ä»£ç å†…å®¹å¯ä»¥åœ¨ Rust åœ¨çº¿ Playground ä¸­è‡ªå·±å°è¯•ã€‚é“¾æ¥ä½äºï¼š[Rust Playground](https://play.rust-lang.org)

### Ownership

Rust çš„ Ownershipï¼ˆæ‰€æœ‰æƒï¼‰æ˜¯ä¿è¯ Rust ç¨‹åºã€Œå†…å­˜å®‰å…¨ã€çš„é‡ç‚¹ç‰¹æ€§ã€‚ä»€ä¹ˆæ˜¯ã€Œå†…å­˜å®‰å…¨ã€ï¼Ÿå°±æ˜¯æŒ‡æˆ–è¯­è¨€æœ¬èº«ï¼Œæˆ–ä½¿ç”¨è¯­è¨€çš„å¼€å‘è€…ï¼Œåœ¨å…¶ç¨‹åºè¿è¡Œæ—¶ç®¡ç†ç³»ç»Ÿçš„ã€Œå†…å­˜åˆ†é…ã€çš„è¿‡ç¨‹ä¸­ä¿è¯å†…å­˜æ²¡æœ‰æµªè´¹ã€æ²¡æœ‰æ³„éœ²ã€‚æˆ‘ä»¬ä¸€èˆ¬çš„ç¨‹åºéƒ½éœ€è¦å®æ–½ã€Œé™æ€ã€ä¸ã€ŒåŠ¨æ€ã€ä¸¤ç§å½¢å¼çš„å†…å­˜åˆ†é…ï¼Œå…¶ä¸­å‰è€…å³å·²çŸ¥å˜é‡çš„å†…å­˜æ‰€å ç©ºé—´ï¼Œç›´æ¥åœ¨å†…å­˜ä¸­åˆ’åˆ†ä¸€éƒ¨åˆ†ä¸å˜çš„åŒºåŸŸç»™å˜é‡ï¼›åè€…ä¸ºåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€çš„ç»™å˜é‡åˆ†é…å†…å­˜ç©ºé—´ï¼Œä½¿å¾—å˜é‡èƒ½å¤Ÿåœ¨ç¨‹åºè¿è¡Œæ—¶å˜åŒ–åœ°å ç”¨å†…å­˜å¤§å°ã€‚

#### æ•°æ®å­˜å‚¨æ–¹å¼

Rust æ˜¯ä½¿ç”¨ã€Œæ ˆã€å’Œã€Œå †ã€è¿™ä¸¤ç§æ•°æ®ç»“æ„æ¥å¯¹è¿™ä¸¤ç§å†…å­˜åˆ†é…å½¢å¼è¿›è¡Œåˆ’åˆ†çš„ã€‚ä¸ºäº†æ›´å¥½çš„ç†è§£ Rust çš„ Ownership çš„å·¥ä½œæœºåˆ¶ï¼Œæˆ‘ä»¬é¦–å…ˆçœ‹çœ‹ Rust æ˜¯å¦‚ä½•åˆ©ç”¨ã€Œæ ˆã€å’Œã€Œå †ã€è¿›è¡Œå†…å­˜åˆ†é…ã€‚

![](https://i.loli.net/2020/01/25/qb3QyEH4euULclY.png)

é¦–å…ˆï¼Œã€Œæ ˆã€ä»å®ç°ä¸Šæ¥è¯´æ˜¯ä¸€ç§æ•ˆç‡éå¸¸é«˜çš„æ•°æ®ç»“æ„ï¼Œå› ä¸ºã€Œæ ˆã€æ‹¥æœ‰ã€Œåè¿›å…ˆå‡ºã€çš„æ•°æ®å­˜å‚¨ç‰¹ç‚¹ï¼ˆLIFOï¼‰ï¼Œä½¿å¾—æœ€åå‹å…¥æ ˆé¡¶çš„å…ƒç´ ä¼šè¢«æœ€å…ˆä»æ ˆé¡¶ç§»å‡ºã€‚è¿™ç§æ•°æ®ç»“æ„çš„ä¼˜åŠ¿åœ¨äºï¼šå½“æˆ‘ä»¬ç”¨ã€Œæ ˆã€æ¥ç»´æŠ¤å†…å­˜æ•°æ®æ—¶ï¼Œ**æˆ‘ä»¬åªéœ€è¦ç»´æŠ¤ã€Œæ ˆé¡¶ã€å…ƒç´ çš„ä¿¡æ¯å³å¯**ã€‚åŒæ—¶ï¼ŒRust å†…å­˜ç®¡ç†çš„ã€Œæ ˆã€åœ¨ç¼–è¯‘æ—¶å³å¯çŸ¥é“å…¶å…·ä½“å¤§å°ï¼Œé™æ€åˆ†é…å†…å­˜ç©ºé—´å³å¯[^3]ã€‚

è€Œ Rust çš„ã€Œå †ã€åˆ™ä¸ä¸€æ ·ï¼Œã€Œå †ã€æ˜¯ä¸€ä¸ªåŠ¨æ€åˆ†é…å†…å­˜ç©ºé—´çš„æ•°æ®ç»“æ„ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ã€Œå †ã€åˆ†é…å†…å­˜ç©ºé—´æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨ã€Œå †ã€ä¸Šå¯»æ‰¾å¯¹åº”çš„å†…å­˜åœ°å€ï¼Œå°†ä¹‹æ ‡è®°ï¼Œå¹¶è¿”å›ä¸ä¹‹ç›¸å¯¹æ˜ çš„æŒ‡é’ˆã€‚è¿™ä¸€è¿‡ç¨‹è·Ÿæˆ‘ä»¬ Cã€C++ ä¸­çš„ allocate memory çš„åŸç†æ˜¯ä¸€è‡´çš„ã€‚

#### æ‰€æœ‰æƒ

ä¸ºä»€ä¹ˆ Rust éœ€è¦å¼•å…¥ã€Œæ‰€æœ‰æƒã€çš„æœºåˆ¶ï¼Ÿå› ä¸º Rust ä¿è¯ã€Œå†…å­˜å®‰å…¨ã€çš„æ–¹æ³•æ˜¯ï¼šè¿½è¸ªç¬¬äºŒç§ã€Œå †ã€ç»“æ„ä¸­å“ªéƒ¨åˆ†æ•°æ®è¢«å“ªéƒ¨åˆ†ä»£ç ä½¿ç”¨ï¼Œä»è€Œå°½é‡å‡å°‘ã€Œå †ã€ä¸­çš„é‡å¤æ•°æ®ï¼Œä¿è¯ã€Œå †ã€ä¸­ä¸å‡ºç°æœ‰æœªä½¿ç”¨çš„æ•°æ®ç­‰é—®é¢˜ã€‚

> Keeping track of what parts of code are using what data on the heap, minimizing the amount of duplicate data on the heap, and cleaning up unused data on the heap so you donâ€™t run out of space are all problems that ownership addresses. â€”â€” [The Rust Book](https://doc.rust-lang.org/book/ch04-01-what-is-ownership.html)

Rust æ­£æ˜¯ä½¿ç”¨åŸºäºã€Œæ‰€æœ‰æƒã€ç†å¿µçš„ä¸€ç³»åˆ—è§„å®šæ¥ä¿è¯ Rust ç¨‹åºçš„ã€Œå†…å­˜å®‰å…¨ã€ã€‚è¿™å…¶ä¸­çš„æœºåˆ¶åŒ…æ‹¬ï¼š

- Rust ä¸­çš„æ¯ä¸ªã€Œå€¼ã€éƒ½æœ‰ä¸€ä¸ªè¢«å«åš owner çš„å˜é‡ï¼ˆæ‰€æœ‰è€…ï¼‰
- åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ª owner
- å½“ owner ç¦»å¼€æˆ‘ä»¬ç¨‹åºæ®µçš„ scope ä¹‹åï¼Œè¿™ä¸€ã€Œå€¼ã€å°±ä¼šè¢«é‡Šæ”¾æ‰

æˆ‘ä»¬æ¥çœ‹ä¸‹é¢çš„å‡ ä¸ªä¾‹å­ï¼Œæ¥å…·ä½“çœ‹çœ‹ Rust å¦‚ä½•ä¿è¯ã€Œå†…å­˜å®‰å…¨ã€çš„ã€‚



### å¼‚å¸¸å¤„ç†

Rust è¯­è¨€å¦å¤–ä¸€ä¸ªè®¾è®¡çš„æ¯”è¾ƒç‹¬ç‰¹çš„åœ°æ–¹åœ¨äºå…¶ã€Œå¼‚å¸¸å¤„ç†ã€çš„æ–¹æ³•ã€‚Rust çš„å¼‚å¸¸å¤„ç†æˆ‘ä¹Ÿè§‰å¾—æ˜¯ç›¸å½“ç›´æˆªäº†å½“çš„ã€‚åœ¨ Rust ä¸–ç•Œä¸­ï¼Œæˆ‘ä»¬æœ‰ï¼š

- å½“å‡ºç°æ— æ³•æ¢å¤çš„å¼‚å¸¸è€Œè°ƒç”¨çš„ã€Œå®ã€ï¼š`panic!`ï¼Œä»¥åŠâ€¦â€¦
- å½“å‡ºç°å¯æ¢å¤çš„å¼‚å¸¸è€Œè¿”å›çš„ï¼š`Result<T, E>`

é¦–å…ˆï¼Œå¼‚å¸¸æ˜¯å¯ä»¥åŒºåˆ†ä¸ºã€Œå¯æ¢å¤ã€ä¸ã€Œä¸å¯æ¢å¤ã€ä¸¤ç§æƒ…å†µçš„ã€‚

## å°ç»“

[^1]: [What is Rust and why is it so popular? - Stack Overflow Blog](https://stackoverflow.blog/2020/01/20/what-is-rust-and-why-is-it-so-popular/)

[^2]: [What do Rust's buzzwords like "safe" and "zero-cost abstraction" mean?](https://www.reddit.com/r/rust/comments/5lg3ih/what_do_rusts_buzzwords_like_safe_and_zerocost/)

[^3]: [Ownership in Rust, Part 1 - Medium](https://medium.com/@thomascountz/ownership-in-rust-part-1-112036b1126b)
